From cfd4f1272cd8555fa69c27b05b7e8eed6c055149 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Ali=20F=C4=B1rat=20ARI?= <afari@gtu.edu.tr>
Date: Mon, 1 Oct 2018 23:45:31 +0300
Subject: [PATCH] Added thermal sensors and mali node

---
 arch/arm64/boot/dts/allwinner/sun50i-a64.dtsi | 76 ++++++++++++++++++-
 1 file changed, 74 insertions(+), 2 deletions(-)

diff --git a/arch/arm64/boot/dts/allwinner/sun50i-a64.dtsi b/arch/arm64/boot/dts/allwinner/sun50i-a64.dtsi
index a54ec95d9f692..1b2c7fc5c8e8b 100644
--- a/arch/arm64/boot/dts/allwinner/sun50i-a64.dtsi
+++ b/arch/arm64/boot/dts/allwinner/sun50i-a64.dtsi
@@ -172,7 +172,41 @@
 		#sound-dai-cells = <0>;
 		compatible = "linux,spdif-dit";
 	};
-
+	
+	reserved-memory {
+		#address-cells = <1>;
+		#size-cells = <1>;
+		ranges;
+ 		cma: linux,cma {
+			compatible = "shared-dma-pool";
+			reusable;
+			size = <0x4000000>;
+			alignment = <0x2000>;
+			linux,cma-default;
+		};
+	};
+	
+	thermal-zones {
+		cpu_thermal: cpu0-thermal {
+		       /* milliseconds */
+		       polling-delay-passive = <250>;
+		       polling-delay = <1000>;
+		       thermal-sensors = <&ths 0>;
+		};
+		gpu0_thermal: gpu0-thermal {
+		       /* milliseconds */
+		       polling-delay-passive = <250>;
+		       polling-delay = <1000>;
+		       thermal-sensors = <&ths 1>;
+		};
+		gpu1_thermal: gpu1-thermal {
+		       /* milliseconds */
+		       polling-delay-passive = <250>;
+		       polling-delay = <1000>;
+		       thermal-sensors = <&ths 2>;
+		};
+	};
+	
 	timer {
 		compatible = "arm,armv8-timer";
 		interrupts = <GIC_PPI 13
@@ -581,7 +615,7 @@
 				pins = "PD0", "PD1", "PD2", "PD3";
 				function = "spi1";
 			};
-
+		
 			uart0_pins_a: uart0 {
 				pins = "PB8", "PB9";
 				function = "uart0";
@@ -671,6 +705,17 @@
 			dmas = <&dma 4>, <&dma 4>;
 			status = "disabled";
 		};
+		
+		ths: thermal-sensor@1c25000 {
+			compatible = "allwinner,sun50i-a64-ths";
+			reg = <0x01c25000 0x100>;
+			interrupts = <GIC_SPI 31 IRQ_TYPE_LEVEL_HIGH>;
+			clocks = <&ccu CLK_BUS_THS>, <&ccu CLK_THS>;
+			clock-names = "bus", "mod";
+			resets = <&ccu RST_BUS_THS>;
+			#io-channel-cells = <0>;
+			#thermal-sensor-cells = <1>;
+		};
 
 		uart0: serial@1c28000 {
 			compatible = "snps,dw-apb-uart";
@@ -813,7 +858,34 @@
 				#size-cells = <0>;
 			};
 		};
+		
+		mali: gpu@1c40000 {
+			compatible = "allwinner,sun50i-a64-mali",
+				     "allwinner,sun7i-a20-mali", "arm,mali-400";
+			reg = <0x01c40000 0x10000>;
+			interrupts = <GIC_SPI 97 IRQ_TYPE_LEVEL_HIGH>,
+				     <GIC_SPI 98 IRQ_TYPE_LEVEL_HIGH>,
+				     <GIC_SPI 99 IRQ_TYPE_LEVEL_HIGH>,
+				     <GIC_SPI 100 IRQ_TYPE_LEVEL_HIGH>,
+				     <GIC_SPI 102 IRQ_TYPE_LEVEL_HIGH>,
+				     <GIC_SPI 103 IRQ_TYPE_LEVEL_HIGH>,
+				     <GIC_SPI 101 IRQ_TYPE_LEVEL_HIGH>;
+			interrupt-names = "gp",
+					  "gpmmu",
+					  "pp0",
+					  "ppmmu0",
+					  "pp1",
+					  "ppmmu1",
+					  "pmu";
+			clocks = <&ccu CLK_BUS_GPU>, <&ccu CLK_GPU>;
+			clock-names = "bus", "core";
+			resets = <&ccu RST_BUS_GPU>;
+			memory-region = <&cma>;
+ 			assigned-clocks = <&ccu CLK_GPU>;
+			assigned-clock-rates = <384000000>;
+		};
 
+		
 		gic: interrupt-controller@1c81000 {
 			compatible = "arm,gic-400";
 			reg = <0x01c81000 0x1000>,
